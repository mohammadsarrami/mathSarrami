<!DOCTYPE html>
<html lang="fa" dir="ltr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>جادوی ضرب کسرها (نسخه نهایی)</title>
    <style>
        @font-face {
            font-family: 'Vazirmatn';
            src: url('https://cdn.jsdelivr.net/gh/rastikerdar/vazirmatn@v33.003/Vazirmatn-Regular.woff2') format('woff2');
            font-weight: normal;
            font-style: normal;
        }

        body {
            font-family: 'Vazirmatn', sans-serif;
            background-color: #f0f8ff;
            color: #333;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            direction: rtl;
        }
        
        .container {
            background-color: #fff;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 8px 16px rgba(0,0,0,0.1);
            width: 90%;
            max-width: 800px;
        }

        h1 {
            color: #005a9c;
            text-align: center;
            border-bottom: 2px solid #abe9cd;
            padding-bottom: 10px;
            font-size: 26px; /* Adjust font size for longer title */
        }
        
        h2 {
            color: #005a9c;
            text-align: center;
            padding-bottom: 10px;
        }


        .input-section {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 20px;
            padding: 20px;
            margin-bottom: 20px;
            background-color: #e6f7ff;
            border-radius: 10px;
            direction: ltr;
        }

        .fraction-input-container {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .fraction-input {
            display: flex;
            flex-direction: column;
            align-items: center;
            font-size: 24px;
        }

        .fraction-input input {
            width: 50px;
            height: 40px;
            text-align: center;
            font-size: 20px;
            border: 2px solid #ccc;
            border-radius: 5px;
            background-color: #fff;
            margin: 0;
        }

        .fraction-input .denominator {
            border-top: 2px solid black;
            padding-top: 5px;
            margin-top: 5px;
        }

        .whole-number-input {
            width: 50px;
            height: 40px;
            text-align: center;
            font-size: 20px;
            border: 2px solid #a0a0a0;
            border-radius: 5px;
        }
        
        .operator-input { font-size: 32px; font-weight: bold; color: #d9534f; }
        
        #solve-button {
            display: block;
            width: 50%;
            margin: 20px auto 0 auto;
            padding: 15px;
            font-size: 20px;
            font-family: 'Vazirmatn', sans-serif;
            font-weight: bold;
            color: white;
            background: linear-gradient(45deg, #28a745, #218838);
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }

        #solve-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0,0,0,0.3);
        }

        #steps-container {
            margin-top: 30px;
            direction: ltr;
            border-top: 2px dashed #005a9c;
            padding-top: 20px;
        }
        
        .step {
            display: flex;
            align-items: center;
            padding: 15px;
            margin-bottom: 15px;
            background-color: #f9f9f9;
            border-left: 5px solid #17a2b8;
            opacity: 0;
            transform: translateY(20px);
            animation: fadeIn 0.5s forwards;
            min-height: 80px;
        }

        @keyframes fadeIn { to { opacity: 1; transform: translateY(0); } }

        .step-label {
            font-weight: bold;
            margin-right: 15px;
            color: #17a2b8;
            direction: rtl;
            min-width: 110px;
            text-align: right;
        }

        .math-expression { display: flex; align-items: center; gap: 15px; font-size: 28px; }
        .fraction, .mixed-number { display: flex; align-items: center; gap: 8px; }
        .fraction-part { display: inline-flex; flex-direction: column; text-align: center; }
        .numerator, .denominator { padding: 2px 8px; position: relative; }
        .denominator { border-top: 2.5px solid black; }
        .whole-number { font-weight: bold; }
        .operator, .equals { font-weight: bold; color: #d9534f; }

        /* --- SIMPLIFICATION STYLES --- */
        .simplified-wrapper { position: relative; display: inline-block; padding: 15px 5px 5px 5px; margin-top: -15px; }
        .old-value { color: #aaa; position: relative; }
        .old-value::after { content: ''; position: absolute; left: -5%; top: 50%; width: 110%; height: 2px; background-color: #d9534f; transform: rotate(-15deg); transform-origin: center center; }
        .new-value { position: absolute; top: -5px; left: 50%; transform: translateX(-50%); font-weight: bold; font-size: 0.8em; }
        .simplify-pair-1 .new-value { color: #007bff; } 
        .simplify-pair-1 .old-value::after { background-color: #007bff; } 
        .simplify-pair-2 .new-value { color: #fd7e14; }
        .simplify-pair-2 .old-value::after { background-color: #fd7e14; }

        /* --- HORIZONTAL LONG FRACTION STYLES --- */
        .long-fraction-multiply {
            display: inline-flex;
            flex-direction: column;
            align-items: center;
            vertical-align: middle;
        }
        
        .long-numerator, .long-denominator {
            display: flex;
            flex-direction: row;
            justify-content: center;
            align-items: center;
            gap: 10px;
            white-space: nowrap;
            padding: 0 10px;
        }

        .long-numerator { padding-bottom: 5px; }
        .long-denominator { border-top: 3px solid black; padding-top: 5px; }

        /* --- DESIGNER CREDIT STYLE --- */
        .designer-credit {
            text-align: center;
            margin-top: 30px;
            padding: 10px;
            font-size: 16px;
            color: #4a4a4a;
            direction: rtl;
        }
    </style>
</head>
<body>

    <div class="container">
        <!-- **** NEW TITLE **** -->
        <h1>ابزار آموزشی بسیار مهم شما برای ضرب کسر ها و ساده سازی کسر ها</h1>
        
        <div class="input-section">
             <div class="fraction-input-container">
                <input type="number" id="whole1" class="whole-number-input" placeholder="عدد صحیح">
                <div class="fraction-input">
                    <input type="number" id="num1" class="numerator" placeholder="صورت">
                    <input type="number" id="den1" class="denominator" placeholder="مخرج">
                </div>
            </div>
            <span class="operator-input">&times;</span>
            <div class="fraction-input-container">
                <input type="number" id="whole2" class="whole-number-input" placeholder="عدد صحیح">
                <div class="fraction-input">
                    <input type="number" id="num2" class="numerator" placeholder="صورت">
                    <input type="number" id="den2" class="denominator" placeholder="مخرج">
                </div>
            </div>
        </div>
        
        <button id="solve-button">حل کن!</button>

        <h2 id="steps-title" style="display:none;">مراحل حل مسئله</h2>
        <div id="steps-container"></div>
    </div>

    <!-- **** DESIGNER NAME **** -->
    <div class="designer-credit">طراح: آقای صرامی</div>

    <script>
        const solveButton = document.getElementById('solve-button');
        const stepsContainer = document.getElementById('steps-container');
        const stepsTitle = document.getElementById('steps-title');

        solveButton.addEventListener('click', solveProblem);

        function gcd(a, b) {
            return b === 0 ? a : gcd(b, a % b);
        }

        function createFractionHTML(n, d, w = null, simplificationData = null) {
            let html = w ? `<div class="mixed-number">` : `<div class="fraction">`;
            
            if (w) {
                html += `<span class="whole-number">${w}</span>`;
            }
            
            let numHTML = n;
            let denHTML = d;

            if (simplificationData) {
                if (simplificationData.n_old !== simplificationData.n_new) {
                    numHTML = `
                        <span class="simplified-wrapper ${simplificationData.n_color}">
                            <span class="old-value">${simplificationData.n_old}</span>
                            <span class="new-value">${simplificationData.n_new}</span>
                        </span>`;
                }
                if (simplificationData.d_old !== simplificationData.d_new) {
                    denHTML = `
                        <span class="simplified-wrapper ${simplificationData.d_color}">
                            <span class="old-value">${simplificationData.d_old}</span>
                            <span class="new-value">${simplificationData.d_new}</span>
                        </span>`;
                }
            }
            
            html += `
                <div class="fraction-part">
                    <span class="numerator">${numHTML}</span>
                    <span class="denominator">${denHTML}</span>
                </div>
            `;
            html += `</div>`;
            return html;
        }

        function solveProblem() {
            stepsContainer.innerHTML = '';
            stepsTitle.style.display = 'block';

            let w1 = parseInt(document.getElementById('whole1').value) || 0;
            let n1_orig = parseInt(document.getElementById('num1').value) || 0;
            let d1_orig = parseInt(document.getElementById('den1').value) || 1;

            let w2 = parseInt(document.getElementById('whole2').value) || 0;
            let n2_orig = parseInt(document.getElementById('num2').value) || 0;
            let d2_orig = parseInt(document.getElementById('den2').value) || 1;
            
            let delay = 0;

            // Step 1
            setTimeout(() => {
                const step1 = document.createElement('div');
                step1.className = 'step';
                let html = `<div class="step-label">مسئله اصلی:</div><div class="math-expression">`;
                html += createFractionHTML(n1_orig, d1_orig, w1 || null);
                html += `<span class="operator">&times;</span>`;
                html += createFractionHTML(n2_orig, d2_orig, w2 || null);
                html += `</div>`;
                step1.innerHTML = html;
                stepsContainer.appendChild(step1);
            }, delay);
            delay += 1000;

            // Convert
            let n1 = d1_orig * w1 + n1_orig;
            let d1 = d1_orig;
            let n2 = d2_orig * w2 + n2_orig;
            let d2 = d2_orig;

            // Step 2
            if (w1 > 0 || w2 > 0) {
                setTimeout(() => {
                    const step2 = document.createElement('div');
                    step2.className = 'step';
                    let html = `<div class="step-label">تبدیل به کسر:</div><div class="math-expression">`;
                    html += createFractionHTML(n1, d1);
                    html += `<span class="operator">&times;</span>`;
                    html += createFractionHTML(n2, d2);
                    html += `</div>`;
                    step2.innerHTML = html;
                    stepsContainer.appendChild(step2);
                }, delay);
                delay += 1500;
            }
            
            // Step 3
            const common_n1_d2 = gcd(n1, d2);
            const n1_new = n1 / common_n1_d2;
            const d2_new = d2 / common_n1_d2;
            const common_n2_d1 = gcd(n2, d1);
            const n2_new = n2 / common_n2_d1;
            const d1_new = d1 / common_n2_d1;
            const wasSimplified = (common_n1_d2 > 1 || common_n2_d1 > 1);
            if(wasSimplified) {
                setTimeout(() => {
                    const step3 = document.createElement('div');
                    step3.className = 'step';
                    const simpData1 = { n_old: n1, n_new: n1_new, n_color: common_n1_d2 > 1 ? 'simplify-pair-1' : '', d_old: d1, d_new: d1_new, d_color: common_n2_d1 > 1 ? 'simplify-pair-2' : '' };
                    const simpData2 = { n_old: n2, n_new: n2_new, n_color: common_n2_d1 > 1 ? 'simplify-pair-2' : '', d_old: d2, d_new: d2_new, d_color: common_n1_d2 > 1 ? 'simplify-pair-1' : '' };
                    let html = `<div class="step-label">ساده‌سازی:</div><div class="math-expression">`;
                    html += createFractionHTML(n1_new, d1_new, null, simpData1);
                    html += `<span class="operator">&times;</span>`;
                    html += createFractionHTML(n2_new, d2_new, null, simpData2);
                    html += `</div>`;
                    step3.innerHTML = html;
                    stepsContainer.appendChild(step3);
                }, delay);
                delay += 2500;
            }

            // Step 4
            const final_n = n1_new * n2_new;
            const final_d = d1_new * d2_new;
            setTimeout(() => {
                const step4 = document.createElement('div');
                step4.className = 'step';
                let html = `<div class="step-label">ضرب نهایی:</div><div class="math-expression">`;
                
                html += `
                    <div class="long-fraction-multiply">
                        <div class="long-numerator">
                            <span>${n1_new}</span>
                            <span>&times;</span>
                            <span>${n2_new}</span>
                        </div>
                        <div class="long-denominator">
                            <span>${d1_new}</span>
                            <span>&times;</span>
                            <span>${d2_new}</span>
                        </div>
                    </div>`;

                html += `<span class="equals">=</span>`;
                html += createFractionHTML(final_n, final_d);
                html += `</div>`;
                step4.innerHTML = html;
                stepsContainer.appendChild(step4);
            }, delay);
            delay += 2000;

            // Step 5
            if (final_n >= final_d) {
                const final_w = Math.floor(final_n / final_d);
                const final_rem_n = final_n % final_d;
                if (final_rem_n > 0) {
                     const final_common = gcd(final_rem_n, final_d);
                     const simplified_n = final_rem_n / final_common;
                     const simplified_d = final_d / final_common;
                    setTimeout(() => {
                        const step5 = document.createElement('div');
                        step5.className = 'step';
                        let html = `<div class="step-label">نتیجه نهایی:</div><div class="math-expression">`;
                        html += createFractionHTML(final_n, final_d);
                        html += `<span class="equals">=</span>`;
                        html += createFractionHTML(simplified_n, simplified_d, final_w);
                        html += `</div>`;
                        step5.innerHTML = html;
                        stepsContainer.appendChild(step5);
                    }, delay);
                } else { 
                     setTimeout(() => {
                        const step5 = document.createElement('div');
                        step5.className = 'step';
                        let html = `<div class="step-label">نتیجه نهایی:</div><div class="math-expression">`;
                        html += createFractionHTML(final_n, final_d);
                        html += `<span class="equals">=</span>`;
                        html += `<span class="whole-number">${final_w}</span>`;
                        html += `</div>`;
                        step5.innerHTML = html;
                        stepsContainer.appendChild(step5);
                    }, delay);
                }
            } else if (final_n > 0) {
                const final_common = gcd(final_n, final_d);
                if (final_common > 1) {
                    const simplified_n = final_n / final_common;
                    const simplified_d = final_d / final_common;
                     setTimeout(() => {
                        const step5 = document.createElement('div');
                        step5.className = 'step';
                        let html = `<div class="step-label">ساده‌سازی نهایی:</div><div class="math-expression">`;
                        html += createFractionHTML(final_n, final_d);
                        html += `<span class="equals">=</span>`;
                        html += createFractionHTML(simplified_n, simplified_d);
                        html += `</div>`;
                        step5.innerHTML = html;
                        stepsContainer.appendChild(step5);
                    }, delay);
                }
            }
        }
    </script>
</body>
</html>
